<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Significant shifts · Pesto.jl</title><meta name="title" content="Significant shifts · Pesto.jl"/><meta property="og:title" content="Significant shifts · Pesto.jl"/><meta property="twitter:title" content="Significant shifts · Pesto.jl"/><meta name="description" content="Documentation for Pesto.jl."/><meta property="og:description" content="Documentation for Pesto.jl."/><meta property="twitter:description" content="Documentation for Pesto.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Pesto.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../install/">Installation</a></li><li><span class="tocitem">Analyses</span><ul><li><a class="tocitem" href="../simple/">Simple analysis</a></li><li><a class="tocitem" href="../twostep/">Two-step analysis</a></li><li><a class="tocitem" href="../shifts/">Number of shifts</a></li><li class="is-active"><a class="tocitem" href>Significant shifts</a><ul class="internal"><li><a class="tocitem" href="#Bayes-factors"><span>Bayes factors</span></a></li><li><a class="tocitem" href="#Plotting-Bayes-factors"><span>Plotting Bayes factors</span></a></li><li><a class="tocitem" href="#Plotting-supported-branches"><span>Plotting supported branches</span></a></li></ul></li><li><a class="tocitem" href="../tiprates/">Tip rates</a></li><li><a class="tocitem" href="../../plotting/ggtree/">Plot with ggtree</a></li></ul></li><li><a class="tocitem" href="../../functions/">Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Analyses</a></li><li class="is-active"><a href>Significant shifts</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Significant shifts</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/kopperud/Pesto.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/kopperud/Pesto.jl/blob/main/docs/src/analysis/bayes_factors.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="bayesfactor"><a class="docs-heading-anchor" href="#bayesfactor">Significant shifts</a><a id="bayesfactor-1"></a><a class="docs-heading-anchor-permalink" href="#bayesfactor" title="Permalink"></a></h1><p>In this vignette we will assess the support for that a branch has at least one rate shift, versus the null hypothesis of no shifts. We will test this using Bayes factors, i.e. the relative support for one or more versus no shifts.</p><h3 id="Tree-file"><a class="docs-heading-anchor" href="#Tree-file">Tree file</a><a id="Tree-file-1"></a><a class="docs-heading-anchor-permalink" href="#Tree-file" title="Permalink"></a></h3><p>First, we load the necessary modules and read in the tree file.</p><pre><code class="language-julia hljs">using Pesto

phy = readtree(Pesto.path(&quot;primates.tre&quot;))
sampling_fraction = 0.62
primates = SSEdata(phy, sampling_fraction)</code></pre><h3 id="Model-setup"><a class="docs-heading-anchor" href="#Model-setup">Model setup</a><a id="Model-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Model-setup" title="Permalink"></a></h3><p>Let&#39;s use the standard <code>Pesto</code> analysis with empirical Bayes for the speciation and extinction rates, and maximum-likelihood shift rate.</p><pre><code class="language-julia hljs">model, rates = pesto(primates; n = 6)</code></pre><h2 id="Bayes-factors"><a class="docs-heading-anchor" href="#Bayes-factors">Bayes factors</a><a id="Bayes-factors-1"></a><a class="docs-heading-anchor-permalink" href="#Bayes-factors" title="Permalink"></a></h2><p>A Bayes factor is a summary of the evidence in favor of one hypothesis, as opposed to a different hypothesis (Kass &amp; Raftery 1995). In <code>Pesto</code>, we use Bayes factors to assess the evidence for the hypothesis that there was at least one diversification rate shift, versus the hypothesis that there were no rate shifts, per branch. The standard equation for a Bayes factor is as follows (see also Shi &amp; Rabosky 2015)</p><p class="math-container">\[    \text{Bayes factor} = \frac{\frac{P_M(\geq \text{1 shifts})}{\pi_M(\geq \text{1 shifts})}}{\frac{P_M(0 \text{ shifts})}{\pi_M(0 \text{ shifts})}}\]</p><p>where <span>$P_M(\geq \text{1 shifts})$</span> is the posterior probability of at least one shift, <span>$P_M(\geq \text{0 shifts})$</span> is the posterior probability of no shifts, <span>$\pi_M(\geq \text{1 shifts})$</span> is the prior probability of at least one shift, and <span>$\pi_M(\geq \text{0 shifts})$</span> is the prior probability of no shifts.</p><h2 id="Plotting-Bayes-factors"><a class="docs-heading-anchor" href="#Plotting-Bayes-factors">Plotting Bayes factors</a><a id="Plotting-Bayes-factors-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-Bayes-factors" title="Permalink"></a></h2><p>We can for example plot the Bayes factor directly on the tree. Since the Bayes factor can vary considerably, we instead plot the log-transformed Bayes factors, which are more concentrated around 0. A log Bayes factor with a value of 0 means that the prior and posterior support for the shift hypotheses are equal. A value much larger than 0 means that there is support for one or more shifts. A value of less than 0 means that there is more support for 0 rate shifts.</p><pre><code class="language-julia hljs">using Makie, CairoMakie

rates[!,&quot;shift_bf_log&quot;] = rates[!,:shift_bf]

min, max = extrema(rates[1:end-1,&quot;shift_bf_log&quot;])
cmap = Makie.cgrad([:gray, :black, :purple])
treeplot(primates, rates, &quot;shift_bf_log&quot;; cmap = cmap)</code></pre><img src="9c450300.svg" alt="Example block output"/><h2 id="Plotting-supported-branches"><a class="docs-heading-anchor" href="#Plotting-supported-branches">Plotting supported branches</a><a id="Plotting-supported-branches-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-supported-branches" title="Permalink"></a></h2><p>Alternatively, we can assess which branches had a strong support for there being at least one shift. We first set the significance level at 10, meaning strong support (Kass &amp; Raftery 1995). Next, we can compute which branches has strong support for at least one diversification rate shift, vs the null hypothesis of zero shifts. </p><table><tr><th style="text-align: right">Bayes factor</th><th style="text-align: right">log10 Bayes factor</th><th style="text-align: right">Level of support</th></tr><tr><td style="text-align: right">0 to 3.2</td><td style="text-align: right">0 to 0.5</td><td style="text-align: right">Not worth mentioning</td></tr><tr><td style="text-align: right">3.2 to 10</td><td style="text-align: right">0.5 to 1</td><td style="text-align: right">Substantial</td></tr><tr><td style="text-align: right">10 to 100</td><td style="text-align: right">1 to 2</td><td style="text-align: right">Strong</td></tr><tr><td style="text-align: right">&gt;100</td><td style="text-align: right">&gt;2</td><td style="text-align: right">Decisive</td></tr></table><p>If we inspect the data frame with the branch-specific outputs, we can see specifically which branches has strong support. </p><pre><code class="language-julia hljs">using DataFrames
cutoff = 3.2
filter(:shift_bf =&gt; x -&gt; x &gt; cutoff, rates)</code></pre><div><div style = "float: left;"><span>3×13 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">delta_lambda</th><th style = "text-align: left;">delta_mu</th><th style = "text-align: left;">delta_netdiv</th><th style = "text-align: left;">delta_relext</th><th style = "text-align: left;">mean_lambda</th><th style = "text-align: left;">mean_mu</th><th style = "text-align: left;">mean_netdiv</th><th style = "text-align: left;">mean_relext</th><th style = "text-align: left;">node</th><th style = "text-align: left;">edge</th><th style = "text-align: left;">nshift</th><th style = "text-align: left;">shift_bf</th><th style = "text-align: left;">shift_bf_log</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">0.044266</td><td style = "text-align: right;">-0.03045</td><td style = "text-align: right;">0.074716</td><td style = "text-align: right;">-0.321868</td><td style = "text-align: right;">0.172548</td><td style = "text-align: right;">0.0949949</td><td style = "text-align: right;">0.0775528</td><td style = "text-align: right;">0.580336</td><td style = "text-align: right;">287</td><td style = "text-align: right;">105</td><td style = "text-align: right;">0.895757</td><td style = "text-align: right;">7.30595</td><td style = "text-align: right;">7.30595</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">0.102268</td><td style = "text-align: right;">-0.00899225</td><td style = "text-align: right;">0.11126</td><td style = "text-align: right;">-0.236665</td><td style = "text-align: right;">0.212724</td><td style = "text-align: right;">0.099386</td><td style = "text-align: right;">0.113338</td><td style = "text-align: right;">0.519477</td><td style = "text-align: right;">376</td><td style = "text-align: right;">283</td><td style = "text-align: right;">0.687401</td><td style = "text-align: right;">5.78283</td><td style = "text-align: right;">5.78283</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">0.174356</td><td style = "text-align: right;">-0.0228849</td><td style = "text-align: right;">0.197241</td><td style = "text-align: right;">-0.400958</td><td style = "text-align: right;">0.22018</td><td style = "text-align: right;">0.100328</td><td style = "text-align: right;">0.119852</td><td style = "text-align: right;">0.548184</td><td style = "text-align: right;">386</td><td style = "text-align: right;">304</td><td style = "text-align: right;">1.05207</td><td style = "text-align: right;">39.65</td><td style = "text-align: right;">39.65</td></tr></tbody></table></div><p>The result is that there are two branches that had strong support for there being at least one shift on the branch. The branch that led to the Old World Monkeys has the highest support (Bayes factor of 6.9), while the gibbons clade (represented by Hylobates) have a slightly lower support (Bayes factor of 3.5). </p><p>In order to plot these, we can create a dummy variable and use it in the tree plotting function.</p><pre><code class="language-julia hljs">rates[!,:strong_support] = Float64.(rates[!,:shift_bf] .&gt; cutoff)
cmap = Makie.cgrad([:black, :red])
treeplot(primates, rates, &quot;strong_support&quot;; cmap = cmap)</code></pre><img src="eb60e4c5.svg" alt="Example block output"/><p>Both the phylogeny plot, as well as the filtered data frame, show two branches that had substantial support (with a Bayes factor of &gt;3.2) for one or more shifts. The number of estimated diversification rate shifts (<span>$\hat{N}$</span>) on this branch is also significantly larger than zero, at 1.05 and 0.65.</p><h3 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h3><ul><li>Kass, R. E., &amp; Raftery, A. E. (1995). Bayes factors. Journal of the american statistical association, 90(430), 773-795.</li><li>Shi, J. J., &amp; Rabosky, D. L. (2015). Speciation dynamics during the global radiation of extant bats. Evolution, 69(6), 1528-1545.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../shifts/">« Number of shifts</a><a class="docs-footer-nextpage" href="../tiprates/">Tip rates »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 13 March 2025 13:50">Thursday 13 March 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
