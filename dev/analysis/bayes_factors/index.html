<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Significant shifts · Pesto.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Pesto.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../install/">Installation</a></li><li><span class="tocitem">Analyses</span><ul><li><a class="tocitem" href="../simple/">Simple analysis</a></li><li><a class="tocitem" href="../extended/">Extended analysis</a></li><li><a class="tocitem" href="../shifts/">Number of shifts</a></li><li class="is-active"><a class="tocitem" href>Significant shifts</a><ul class="internal"><li><a class="tocitem" href="#Bayes-factors"><span>Bayes factors</span></a></li><li><a class="tocitem" href="#Plotting-Bayes-factors"><span>Plotting Bayes factors</span></a></li><li><a class="tocitem" href="#Plotting-supported-branches"><span>Plotting supported branches</span></a></li></ul></li><li><a class="tocitem" href="../tiprates/">Tip rates</a></li></ul></li><li><a class="tocitem" href="../../functions/">Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Analyses</a></li><li class="is-active"><a href>Significant shifts</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Significant shifts</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/kopperud/Pesto.jl/blob/main/docs/src/analysis/bayes_factors.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="bayesfactor"><a class="docs-heading-anchor" href="#bayesfactor">Significant shifts</a><a id="bayesfactor-1"></a><a class="docs-heading-anchor-permalink" href="#bayesfactor" title="Permalink"></a></h1><p>In this vignette we will assess the support for that a branch has at least one rate shift, versus the null hypothesis of no shifts. We will test this using Bayes factors, i.e. the relative support for one or more versus no shifts.</p><h3 id="Tree-file"><a class="docs-heading-anchor" href="#Tree-file">Tree file</a><a id="Tree-file-1"></a><a class="docs-heading-anchor-permalink" href="#Tree-file" title="Permalink"></a></h3><p>First, we load the necessary modules and read in the tree file.</p><pre><code class="language-julia hljs">using Pesto
using Plots

phy = readtree(Pesto.path(&quot;primates.tre&quot;))
ρ = 0.635
primates = SSEdata(phy, ρ)</code></pre><h3 id="Model-setup"><a class="docs-heading-anchor" href="#Model-setup">Model setup</a><a id="Model-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Model-setup" title="Permalink"></a></h3><p>Let&#39;s use the standard <code>Pesto</code> analysis with empirical Bayes for the speciation and extinction rates, and maximum-likelihood shift rate.</p><pre><code class="language-julia hljs">model, rates = pesto(primates; n = 6)</code></pre><h2 id="Bayes-factors"><a class="docs-heading-anchor" href="#Bayes-factors">Bayes factors</a><a id="Bayes-factors-1"></a><a class="docs-heading-anchor-permalink" href="#Bayes-factors" title="Permalink"></a></h2><p>A Bayes factor is a summary of the evidence in favor of one hypothesis, as opposed to a different hypothesis (Kass &amp; Raftery 1995). In <code>Pesto</code>, we use Bayes factors to assess the evidence for the hypothesis that there was at least one diversification rate shift, versus the hypothesis that there were no rate shifts, per branch. The standard equation for a Bayes factor is as follows (see also Shi &amp; Rabosky 2015)</p><p class="math-container">\[    \text{Bayes factor} = \frac{\frac{P_M(\geq \text{1 shifts})}{\pi_M(\geq \text{1 shifts})}}{\frac{P_M(0 \text{ shifts})}{\pi_M(0 \text{ shifts})}}\]</p><p>where <span>$P_M(\geq \text{1 shifts})$</span> is the posterior probability of at least one shift, <span>$P_M(\geq \text{0 shifts})$</span> is the posterior probability of no shifts, <span>$\pi_M(\geq \text{1 shifts})$</span> is the prior probability of at least one shift, and <span>$\pi_M(\geq \text{0 shifts})$</span> is the prior probability of no shifts.</p><h2 id="Plotting-Bayes-factors"><a class="docs-heading-anchor" href="#Plotting-Bayes-factors">Plotting Bayes factors</a><a id="Plotting-Bayes-factors-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-Bayes-factors" title="Permalink"></a></h2><pre><code class="language-julia hljs">using RCall

@rput primates
@rput rates

R&quot;&quot;&quot;
library(tibble)
library(tidytree)

x &lt;- as_tibble(primates)
td &lt;- as.treedata(merge(x, rates, by = &quot;node&quot;))
&quot;&quot;&quot;</code></pre><p>We can for example plot the Bayes factor directly on the tree. Since the Bayes factor can vary considerably, we instead plot the log-transformed Bayes factors, which are more concentrated around 0. A log Bayes factor with a value of 0 means that the prior and posterior support for the shift hypotheses are equal. A value much larger than 0 means that there is support for one or more shifts. A value of less than 0 means that there is more support for 0 rate shifts.</p><pre><code class="language-julia hljs">R&quot;&quot;&quot;
library(ggplot2)
library(ggtree)
p1 &lt;- ggtree(td, aes(color = log(shift_bf))) +
    scale_color_gradient2(low = &quot;white&quot;, mid = &quot;black&quot;, high = &quot;red&quot;, midpoint = 0) +
    geom_tiplab(size=2) +
    labs(color = &quot;log Bayes factor&quot;)
&quot;&quot;&quot;</code></pre><p><img src="../../assets/bayes_factor_phylogeny.svg" alt="primatestree"/></p><h2 id="Plotting-supported-branches"><a class="docs-heading-anchor" href="#Plotting-supported-branches">Plotting supported branches</a><a id="Plotting-supported-branches-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-supported-branches" title="Permalink"></a></h2><p>Alternatively, we can assess which branches had a strong support for there being at least one shift. We first set the significance level at 10, meaning strong support (Kass &amp; Raftery 1995). Next, we can compute which branches has strong support for at least one diversification rate shift, vs the null hypothesis of zero shifts. </p><table><tr><th style="text-align: right">Bayes factor</th><th style="text-align: right">log10 Bayes factor</th><th style="text-align: right">Level of support</th></tr><tr><td style="text-align: right">0 to 3.2</td><td style="text-align: right">0 to 0.5</td><td style="text-align: right">Not worth mentioning</td></tr><tr><td style="text-align: right">3.2 to 10</td><td style="text-align: right">0.5 to 1</td><td style="text-align: right">Substantial</td></tr><tr><td style="text-align: right">10 to 100</td><td style="text-align: right">1 to 2</td><td style="text-align: right">Strong</td></tr><tr><td style="text-align: right">&gt;100</td><td style="text-align: right">&gt;2</td><td style="text-align: right">Decisive</td></tr></table><pre><code class="language-julia hljs">R&quot;&quot;&quot;
significance_level &lt;- 10

td@data$signif_shifts &lt;- factor(td@data$shift_bf &gt; significance_level)
p2 &lt;- ggtree(td, aes(color = signif_shifts)) +
    scale_color_manual(values = c(&quot;black&quot;, &quot;red&quot;), labels = c(&quot;no support&quot;, &quot;strong support&quot;)) +
    geom_tiplab(size=2) +
    labs(color = &quot;Significant shift&quot;)
&quot;&quot;&quot;</code></pre><p><img src="../../assets/signif_support.svg" alt="primatestree"/></p><p>If we inspect the data frame with the branch-specific outputs, we can also see this branch specifically. Both the phylogeny plot, as well as the filtered data frame, only show one branch that had strong support (with a Bayes factor of &gt;10) for one or more shifts. The number of estimated diversification rate shifts (<span>$\hat{N}$</span>) on this branch is also significantly larger than one, almost at 1 number of shifts.</p><pre><code class="language-julia hljs">using DataFrames
filter(:shift_bf =&gt; x -&gt; x &gt; 10, rates)</code></pre><div><div style = "float: left;"><span>1×8 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">mean_lambda</th><th style = "text-align: left;">mean_mu</th><th style = "text-align: left;">mean_netdiv</th><th style = "text-align: left;">mean_relext</th><th style = "text-align: left;">node</th><th style = "text-align: left;">edge</th><th style = "text-align: left;">nshift</th><th style = "text-align: left;">shift_bf</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">0.287772</td><td style = "text-align: right;">0.154607</td><td style = "text-align: right;">0.133165</td><td style = "text-align: right;">0.554899</td><td style = "text-align: right;">386</td><td style = "text-align: right;">304</td><td style = "text-align: right;">0.902697</td><td style = "text-align: right;">30.7252</td></tr></tbody></table></div><h3 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h3><ul><li>Kass, R. E., &amp; Raftery, A. E. (1995). Bayes factors. Journal of the american statistical association, 90(430), 773-795.</li><li>Shi, J. J., &amp; Rabosky, D. L. (2015). Speciation dynamics during the global radiation of extant bats. Evolution, 69(6), 1528-1545.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../shifts/">« Number of shifts</a><a class="docs-footer-nextpage" href="../tiprates/">Tip rates »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 27 November 2023 11:11">Monday 27 November 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
