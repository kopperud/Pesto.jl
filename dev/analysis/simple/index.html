<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Simple analysis · Pesto.jl</title><meta name="title" content="Simple analysis · Pesto.jl"/><meta property="og:title" content="Simple analysis · Pesto.jl"/><meta property="twitter:title" content="Simple analysis · Pesto.jl"/><meta name="description" content="Documentation for Pesto.jl."/><meta property="og:description" content="Documentation for Pesto.jl."/><meta property="twitter:description" content="Documentation for Pesto.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Pesto.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../install/">Installation</a></li><li><span class="tocitem">Analyses</span><ul><li class="is-active"><a class="tocitem" href>Simple analysis</a><ul class="internal"><li><a class="tocitem" href="#Tree-file"><span>Tree file</span></a></li><li><a class="tocitem" href="#Two-step-analysis"><span>Two-step analysis</span></a></li><li><a class="tocitem" href="#Joint-analysis"><span>Joint analysis</span></a></li><li><a class="tocitem" href="#Tree-plots"><span>Tree plots</span></a></li><li><a class="tocitem" href="#Save-to-file"><span>Save to file</span></a></li></ul></li><li><a class="tocitem" href="../twostep/">Two-step analysis</a></li><li><a class="tocitem" href="../shifts/">Number of shifts</a></li><li><a class="tocitem" href="../bayes_factors/">Significant shifts</a></li><li><a class="tocitem" href="../tiprates/">Tip rates</a></li><li><a class="tocitem" href="../../plotting/ggtree/">Plot with ggtree</a></li></ul></li><li><a class="tocitem" href="../../functions/">Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Analyses</a></li><li class="is-active"><a href>Simple analysis</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Simple analysis</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/kopperud/Pesto.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/kopperud/Pesto.jl/blob/main/docs/src/analysis/simple.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="simple"><a class="docs-heading-anchor" href="#simple">Simple analysis</a><a id="simple-1"></a><a class="docs-heading-anchor-permalink" href="#simple" title="Permalink"></a></h1><p>Here is an example of an analysis of branch-specific rates under the birth-death-shift model. </p><h2 id="Tree-file"><a class="docs-heading-anchor" href="#Tree-file">Tree file</a><a id="Tree-file-1"></a><a class="docs-heading-anchor-permalink" href="#Tree-file" title="Permalink"></a></h2><p>First, we load the necessary modules and read in the tree file. We assume that we know the total number of extant species, and using that we can calculate the sampling fraction.</p><pre><code class="language-julia hljs">using Pesto

phy = readtree(Pesto.path(&quot;primates.tre&quot;))
sampling_fraction = 0.62
primates = SSEdata(phy, sampling_fraction)</code></pre><h2 id="Two-step-analysis"><a class="docs-heading-anchor" href="#Two-step-analysis">Two-step analysis</a><a id="Two-step-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Two-step-analysis" title="Permalink"></a></h2><p>A two-step analysis can be done like so:</p><pre><code class="language-julia hljs">model, rates = pesto_twostep(primates)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: At t=24.135867122172158, dt was forced below floating point epsilon -2.8060793791894357e-15, and step error estimate = 1.1360590045188136e-26. Aborting. There is either an error in your model specification or the true solution is unstable (or the true solution can not be represented in the precision of Float64).
└ @ SciMLBase ~/.julia/packages/SciMLBase/AkGLd/src/integrator_interface.jl:623
┌ Warning: At t=6.6440402265604845, dt was forced below floating point epsilon -7.300509314535631e-16, and step error estimate = 2.599653927305601e-27. Aborting. There is either an error in your model specification or the true solution is unstable (or the true solution can not be represented in the precision of Float64).
└ @ SciMLBase ~/.julia/packages/SciMLBase/AkGLd/src/integrator_interface.jl:623
┌ Warning: At t=24.135867122172158, dt was forced below floating point epsilon -2.8060793791894357e-15, and step error estimate = 1.1360590045188136e-26. Aborting. There is either an error in your model specification or the true solution is unstable (or the true solution can not be represented in the precision of Float64).
└ @ SciMLBase ~/.julia/packages/SciMLBase/AkGLd/src/integrator_interface.jl:623
┌ Warning: At t=6.6440402265604845, dt was forced below floating point epsilon -7.300509314535631e-16, and step error estimate = 2.599653927305601e-27. Aborting. There is either an error in your model specification or the true solution is unstable (or the true solution can not be represented in the precision of Float64).
└ @ SciMLBase ~/.julia/packages/SciMLBase/AkGLd/src/integrator_interface.jl:623</code></pre><p>To see how this analysis is set up, see the next section (<a href="../twostep/#twostep">Two-step analysis</a>).</p><h2 id="Joint-analysis"><a class="docs-heading-anchor" href="#Joint-analysis">Joint analysis</a><a id="Joint-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Joint-analysis" title="Permalink"></a></h2><p>A joint analysis, meaning that we estimate i) the parameters of the base distribution (<span>$\hat{\lambda},\hat{\mu}$</span>) and ii) the shift rate (<span>$\eta$</span>) jointly using maximum likelihood.</p><pre><code class="language-julia hljs">model, rates = pesto(primates)</code></pre><p>We think that the joint estimation procedure is more statistically robust than the two-step analysis, however there are also a few disadvantages. First, as we use Newton&#39;s method to find the maximum-likelihood estimates, it can be a bit slower than the two step method. Second, the joint estimation procedure can sometimes diverge (i.e. it may get stuck in local likelihood optima and return different parameter estimates). We therefore recommend to run the inference a few times, to inspect the parameters and the likelihood score. If the parameter estimates (and the tree plots) look reasonable, but two or more models have different likelihoods, we recommend to pick the model that has the highest likelihood score.</p><h2 id="Tree-plots"><a class="docs-heading-anchor" href="#Tree-plots">Tree plots</a><a id="Tree-plots-1"></a><a class="docs-heading-anchor-permalink" href="#Tree-plots" title="Permalink"></a></h2><p>If we want to plot the results immediately, we will need to use the <code>Makie</code> dependency. <code>Makie</code> has several backends, but we will use <code>CairoMakie</code> for now, as it is designed to plot high-quality 2-dimensional figures.</p><pre><code class="language-julia hljs">using Makie, CairoMakie

treeplot(primates, rates)</code></pre><img src="e8a1ee4b.svg" alt="Example block output"/><p>If you want to instead plot the number of shifts, and for example use a different color gradient, you can enter the following</p><pre><code class="language-julia hljs">cmap = Makie.cgrad([:black, :red])
f = treeplot(primates, rates, &quot;nshift&quot;; cmap = cmap)</code></pre><img src="a0f19a0e.svg" alt="Example block output"/><p>The figure can be saved using the following code</p><pre><code class="language-julia hljs">Makie.save(&quot;path/to/figure.pdf&quot;, f)</code></pre><p>See section <a href="../../plotting/ggtree/#ggtree">Plot with ggtree</a> for more instructions on how to make more customized and publication-quality figures.</p><h2 id="Save-to-file"><a class="docs-heading-anchor" href="#Save-to-file">Save to file</a><a id="Save-to-file-1"></a><a class="docs-heading-anchor-permalink" href="#Save-to-file" title="Permalink"></a></h2><p>A summary of the results of the analysis is stored in the <code>rates</code> object, which is a data frame. We can print the first five rows to get an idea of it:</p><pre><code class="language-julia hljs">rates[1:5,:]</code></pre><div><div style = "float: left;"><span>5×12 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">delta_lambda</th><th style = "text-align: left;">delta_mu</th><th style = "text-align: left;">delta_netdiv</th><th style = "text-align: left;">delta_relext</th><th style = "text-align: left;">mean_lambda</th><th style = "text-align: left;">mean_mu</th><th style = "text-align: left;">mean_netdiv</th><th style = "text-align: left;">mean_relext</th><th style = "text-align: left;">node</th><th style = "text-align: left;">edge</th><th style = "text-align: left;">nshift</th><th style = "text-align: left;">shift_bf</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">0.00467827</td><td style = "text-align: right;">-0.0118875</td><td style = "text-align: right;">0.0165658</td><td style = "text-align: right;">-0.120128</td><td style = "text-align: right;">0.14757</td><td style = "text-align: right;">0.107534</td><td style = "text-align: right;">0.0400362</td><td style = "text-align: right;">0.742555</td><td style = "text-align: right;">235</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.255378</td><td style = "text-align: right;">1.18774</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">0.0240223</td><td style = "text-align: right;">-0.00975873</td><td style = "text-align: right;">0.033781</td><td style = "text-align: right;">-0.14298</td><td style = "text-align: right;">0.156696</td><td style = "text-align: right;">0.0978791</td><td style = "text-align: right;">0.0588164</td><td style = "text-align: right;">0.639364</td><td style = "text-align: right;">236</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0.560818</td><td style = "text-align: right;">1.15181</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">0.0429241</td><td style = "text-align: right;">-0.00457723</td><td style = "text-align: right;">0.0475014</td><td style = "text-align: right;">-0.117448</td><td style = "text-align: right;">0.189481</td><td style = "text-align: right;">0.0901939</td><td style = "text-align: right;">0.0992873</td><td style = "text-align: right;">0.497947</td><td style = "text-align: right;">237</td><td style = "text-align: right;">3</td><td style = "text-align: right;">0.398324</td><td style = "text-align: right;">2.36154</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">0.00136795</td><td style = "text-align: right;">0.00019076</td><td style = "text-align: right;">0.00117719</td><td style = "text-align: right;">0.00197336</td><td style = "text-align: right;">0.217506</td><td style = "text-align: right;">0.0874021</td><td style = "text-align: right;">0.130104</td><td style = "text-align: right;">0.423328</td><td style = "text-align: right;">238</td><td style = "text-align: right;">4</td><td style = "text-align: right;">0.0631717</td><td style = "text-align: right;">0.742246</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">-0.00299264</td><td style = "text-align: right;">0.00103422</td><td style = "text-align: right;">-0.00402687</td><td style = "text-align: right;">0.022803</td><td style = "text-align: right;">0.216826</td><td style = "text-align: right;">0.0879636</td><td style = "text-align: right;">0.128862</td><td style = "text-align: right;">0.435138</td><td style = "text-align: right;">1</td><td style = "text-align: right;">5</td><td style = "text-align: right;">0.0619978</td><td style = "text-align: right;">0.995818</td></tr></tbody></table></div><p>Each row in the data frame represents a branch in the tree, indexed by the edge index <code>edge</code>.  Alternatively, you can index the rows using the <code>node</code> index.  It is possible to save the data-frame as is to a file, using <code>using CSV; CSV.write(&quot;rates.csv&quot;, rates)</code>. We can also represent the output as an extended newick string:</p><pre><code class="language-julia hljs">newick(primates, rates)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;(((((Galago_matschiei[&amp;delta_lambda=-0.002992644083732232,delta_mu=0.0010342227504288176,delta_netdiv=-0.004026866834161008,delta_relext=0.02280302525823147,mean_lambda=0.2168258714036405,mean_mu=0.08796359545156955,mean_netdiv=0.12886227595207098,mean_relext=0.4351384&quot;<span class="sgr93"><span class="sgr1"> ⋯ 159054 bytes ⋯ </span></span>&quot;elta_netdiv=0.004173101681074584,delta_relext=-0.03948411867658641,mean_lambda=0.14604290849490387,mean_mu=0.11199343012498383,mean_netdiv=0.034049478369920005,mean_relext=0.7821356720421896,edge=94,nshift=0.05098594344083376,shift_bf=1.2095368951142889]:2.491564):0.0;&quot;</code></pre><p>If we want to save the newick string to a file, we can use the <code>writenewick</code> function</p><pre><code class="language-julia hljs">writenewick(&quot;primates_analysis.tre&quot;, primates, rates)</code></pre><p>This tree file can be loaded in other programs such as <code>R</code> and can be plotted using standard packages like <code>ape</code> and <code>ggtree</code> (see section <a href="../../plotting/ggtree/#ggtree">Plot with ggtree</a>).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../install/">« Installation</a><a class="docs-footer-nextpage" href="../twostep/">Two-step analysis »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 7 March 2025 16:49">Friday 7 March 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
