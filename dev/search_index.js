var documenterSearchIndex = {"docs":
[{"location":"analysis/#Tiny-rate-analysis","page":"Rate analysis","title":"Tiny rate analysis","text":"","category":"section"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"Here is an example of an analysis of branch-specific rates under the birth-death model. We use a State-dependent Speciation Extinction (SSE) model, with a K-sized state space, in order to get at the question of rate heterogeneity across branches. The Binary SSE model (BiSSE) was first introduced to study rate variation in association with trait data, i.e. each species was assigned a state at the tips of the tree. In our approach, however, we don't use trait data, and consider the tip states unknown, and equally probably for all states at the tips. ","category":"page"},{"location":"analysis/#Load-and-read-files","page":"Rate analysis","title":"Load and read files","text":"","category":"section"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"First, we load the necessary modules and read in the tree file.","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"using Distributions\nusing Pesto\n\nphy = readtree(Pesto.path(\"primates.tre\"))\nρ = 0.635\nprimates = SSEdata(phy, ρ)","category":"page"},{"location":"analysis/#SSE-model","page":"Rate analysis","title":"SSE model","text":"","category":"section"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"Next, we set up the SSE model, including its dimensionality and hyperparameters. For this model, we will draw the speciation rate (λ) and extinction rate (µ) from LogNormal distributions. We pick the median of the LogNormal distributions such that they correspond to the maximum-likelihood estimates of the constant-rate birth-death model. We pick the log-sd as H = 0.587, which corresponds to a LogNormal distribution whose 2.5%-97.5% quantile spans one order of magnitude. ","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"λml, μml = estimate_constant_bdp(primates)\n\nH = 0.587\nn = 6\n\ndλ = LogNormal(log(λml), H)\ndμ = LogNormal(log(µml), H)\n\nλquantiles = make_quantiles(dλ, n)\nµquantiles = make_quantiles(dμ, n)\nλ, μ = allpairwise(λquantiles, µquantiles)","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"(Image: primatestree)","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"Next, we estimate the rate shift parameter η under the SSE model, conditional on λ and µ.","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"η = optimize_eta(λ, µ, primates)","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"This allows us to set up the SSE model object:","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"model = SSEconstant(λ, μ, η)","category":"page"},{"location":"analysis/#Likelihood","page":"Rate analysis","title":"Likelihood","text":"","category":"section"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"With the model and data objects we can for example calculate the loglikelihood","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"logL_root(model, primates)","category":"page"},{"location":"analysis/#Branch-likelihoods","page":"Rate analysis","title":"Branch likelihoods","text":"","category":"section"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"Or we can compute both the postorder and preorder pass, and get the expected speciation and extinction rates per branch:","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"#res = bds(model,primates)\nrates = birth_death_shift(model, primates)","category":"page"},{"location":"analysis/#Plot-using-R-and-ggtree","page":"Rate analysis","title":"Plot using R and ggtree","text":"","category":"section"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"If we want to plot the results, we can use the module RCall. Julia objects can be exported to an R session using the macro @rput, (and retrieved from R with @rget). R code can be called by prefixing a string with R, e.g. R\"print()\", or multiline R\"\"\"...\"\"\". You can also enter the R session interactively through the Julia REPL by entering the character $. Here we plot the phylogeny using some R-packages that we load first.","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"using RCall\n\n@rput primates\n@rput rates\n\nR\"\"\"\nlibrary(tibble)\nlibrary(tidytree)\nx <- as_tibble(primates)\ntd <- as.treedata(merge(x, rates, by = \"node\"))\n\"\"\"","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"We can plot the mean speciation rate","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"R\"\"\"\nlibrary(ggtree)\np1 <- ggtree(td, aes(color = mean_lambda)) +  \n    geom_tiplab(size=2)\n\"\"\"","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"(Image: primatestree)","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"We can also plot the number of accumulated shifts on the branches","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"R\"\"\"\nlibrary(ggplot2)\np2 <- ggtree(td, aes(color = nshift)) + \n    geom_tiplab(size=2) +\n    scale_colour_gradient(low = \"black\", high = \"red\")\n\"\"\"","category":"page"},{"location":"analysis/","page":"Rate analysis","title":"Rate analysis","text":"(Image: primatestree)","category":"page"},{"location":"install/#Installation-Julia","page":"Installation","title":"Installation Julia","text":"","category":"section"},{"location":"install/","page":"Installation","title":"Installation","text":"Go to the Julia website at https://julialang.org/downloads/, download the binary for your operating system, and save it somewhere appropriate. If you are using Mac/Linux, you may want to add the directory in which you saved the julia executable to the PATH variable. If you use the bash terminal, you can do this by appending the following to your ~/.bashrc file:","category":"page"},{"location":"install/","page":"Installation","title":"Installation","text":"export PATH=\"/path/to/julia-x.x.x/bin:$PATH\"","category":"page"},{"location":"install/","page":"Installation","title":"Installation","text":"Make sure to substitute /path/to with your directory, and fill in the correct version instead of x.x.x. This will allow you to start julia by typing julia into the terminal, regardless of which directory you are in.","category":"page"},{"location":"install/#Installing-Pesto.jl","page":"Installation","title":"Installing Pesto.jl","text":"","category":"section"},{"location":"install/","page":"Installation","title":"Installation","text":"We have not yet registered the module with the Julia package manager, meaning it has to be installed using a git repository URL. This can be done in the REPL as follows:","category":"page"},{"location":"install/","page":"Installation","title":"Installation","text":"import Pkg\n\nPkg.add(url=\"https://github.com/kopperud/Pesto.jl\")","category":"page"},{"location":"install/","page":"Installation","title":"Installation","text":"Even though the module is not registered, the package manager (Pkg) will automatically resolve and install any necessary dependencies. Loading the module is done as follows:","category":"page"},{"location":"install/","page":"Installation","title":"Installation","text":"using Pesto","category":"page"},{"location":"install/","page":"Installation","title":"Installation","text":"Since Julia is a JIT (just-in-time) compiled language, any code must be compiled before it can be run. To save some time, there is also a pre-compiling step the first time a module is loaded. This means we have to wait a short while. Once the module is finished pre-compiling, you are now ready!","category":"page"},{"location":"#Pesto.jl-Documentation","page":"Pesto.jl Documentation","title":"Pesto.jl Documentation","text":"","category":"section"},{"location":"","page":"Pesto.jl Documentation","title":"Pesto.jl Documentation","text":"lorem ipsum","category":"page"},{"location":"","page":"Pesto.jl Documentation","title":"Pesto.jl Documentation","text":"plottree(x)","category":"page"},{"location":"#Pesto.plottree-Tuple{Any}","page":"Pesto.jl Documentation","title":"Pesto.plottree","text":"plottree(x)\n\nExample:\n\nres = bds(model, data)\nplottree(res)\n\n\n\n\n\n","category":"method"},{"location":"","page":"Pesto.jl Documentation","title":"Pesto.jl Documentation","text":"birth_death_shift(model, data)","category":"page"},{"location":"#Pesto.birth_death_shift-Tuple{Any, Any}","page":"Pesto.jl Documentation","title":"Pesto.birth_death_shift","text":"birth_death_shift(model, data[; verbose = false])\n\nCalculates average branch rates under the birth-death-shift model with a finite state space.\n\nExample:\n\nusing Pesto\n\nphy = readtree(Pesto.path(\"bears.tre\")) \nρ = 1.0  \ndata = make_SSEdata(phy, \"\", ρ; include_traits = false) \nλ = [0.1, 0.2] \nμ = [0.05, 0.15] \n\nη = 0.05 \nmodel = SSEconstant(λ, μ, η)\n\nres = birth_death_shift(model, data)\n\n\n\n\n\n","category":"method"},{"location":"","page":"Pesto.jl Documentation","title":"Pesto.jl Documentation","text":"Econstant(t, λ, µ, ρ)","category":"page"},{"location":"#Pesto.Econstant-NTuple{4, Any}","page":"Pesto.jl Documentation","title":"Pesto.Econstant","text":"from Morlon et al. 2011 [PNAS], eq. S4\n\nE(t) = 1 - fracexp(t(lambda - mu))frac1rho + fraclambdalambda -mu Big ( exp((lambda - mu)t) - 1 Big)\n\n\n\n\n\n","category":"method"},{"location":"","page":"Pesto.jl Documentation","title":"Pesto.jl Documentation","text":"ψ(t, λ, µ, ρ)","category":"page"},{"location":"#Pesto.ψ-NTuple{4, Any}","page":"Pesto.jl Documentation","title":"Pesto.ψ","text":"Equation S5 in Morlon et al. 2011 [PNAS]\n\npsi(s t) = e^(lambda - mu)(t - s)  1 + fracfraclambdalambda - mu(e^t(lambda - mu) - e^s(lambda-mu))frac1rho + fraclambdalambda - mu times (e^s(lambda-mu)-1)^-2\n\nWe use this one, simplified where s = 0\n\npsi(t) = frace^t(lambda - mu)  1 + fracrho lambdalambda - mu(e^t(lambda - mu) - 1)^2\n\nExample:\n\nρ = 1.0\nλ = 1.0\nμ = 0.5\nt = 0.1\n\nψ(t, λ, μ, ρ)\n\n\n\n\n\n","category":"method"},{"location":"","page":"Pesto.jl Documentation","title":"Pesto.jl Documentation","text":"lp(λ, μ, data::SSEdata)","category":"page"},{"location":"#Pesto.lp-Tuple{Any, Any, SSEdata}","page":"Pesto.jl Documentation","title":"Pesto.lp","text":"lp(λ, μ, data)\n\nFrom Louca and Pennell 2020 (Nature), eq. S28\n\nL = fracrho^n+1 lambda (1 - E(t_1))^2 times prod_i=1^n lambda times psi(0 t_i) \nE(t) = 1 - fracexp(lambda - mu)tfrac1rho + fraclambdalambda -mu Big ( exp((lambda - mu)t) - 1 Big) \npsi(t) = frace^t(lambda - mu)  1 + fracrho lambdalambda - mu(e^t(lambda - mu) - 1)^2\n\nLogged:\n\nlog(L) = (n+1) log(rho) + log(psi(t_1)) - log(lambda) - 2 log(1 - E(t_1)) + sum_i=1^n log(lambda) + log(psi(t_i))\n\nExample:\n\nλ = 1.0\nμ = 0.5\n\nphy = readtrees(Pesto.path(\"bears.tre\"))\nρ = 1.0\ndata = make_SSEdata2(phy, ρ)\n\nlp(λ, μ, data)\n\n\n\n\n\n","category":"method"},{"location":"","page":"Pesto.jl Documentation","title":"Pesto.jl Documentation","text":"estimate_constant_bdp(data::SSEdata)","category":"page"},{"location":"#Pesto.estimate_constant_bdp-Tuple{SSEdata}","page":"Pesto.jl Documentation","title":"Pesto.estimate_constant_bdp","text":"estimate_constant_bdp(data::SSEdata[; xinit = [0.11, 0.09], lower = [0.0001, 0.0001], upper = [20.0, 20.0]])\n\nEstimates the speciation and extinction rate under the reconstructed birth-death process with time-homogeneous rates.\n\nExample:\n\nphy = readtree(Pesto.path(\"primates.tre\"))\nρ = 0.67\ndata = make_SSEdata2(phy, ρ)\n\nλml, μml = estimate_constant_bdp(data)\n\n\n\n\n\n","category":"method"}]
}
